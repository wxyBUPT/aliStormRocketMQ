# tianchiRace 

测试记录：

[INFO 2016-06-30 22:09:17 c.a.m.r.j.b.PayMessageDeserializeBolt:114 Thread-44] Deserialize : 177030pay message has been succeed emit.0pay message has not been emit

* 2016/06/30 22:25:17 当前版本为单个worker，并将订单信息存储到本地的cache 中，所有的bolt都为1，准确率为12.95%，查看日志数据量比较小，并且查看本地Cache总是失败

```  
[INFO 2016-06-30 22:30:17 c.a.m.r.j.b.f.ReportTbTmTradeThread:55 Thread-67] TmTbTradeSynchronization:  current plat form : platformTmall_41084gxo4o_current plat trades per miniute{1467035520=4.089747274E7, 1467035760=4.056556434999992E7, 1467035460=3.837811782000002E7, 1467035700=4.0238176350000024E7,
  1467035940=1.0159704050000003E7, 1467035400=3.072558290999997E7, 1467035640=3.981135577999998E7, 1467035880=3.708848816999998E7, 1467035580=4.178649927999997E7, 1467035820=3.757089560000003E7}
  [INFO 2016-06-30 22:30:17 c.a.m.r.j.b.f.ReportTbTmTradeThread:55 Thread-69] TmTbTradeSynchronization:  current plat form : platformTaobao_41084gxo4o_current plat trades per miniute{1467035520=4.53363599639999E8, 1467035760=4.653839051000007E8, 1467035460=4.599145386199974E8, 1467035700=4.6232464525000083E8, 1467035940=1.0669599839000008E8, 1467035400=3.1371339629999965E8, 1467035640=4.576756893300001E8, 1467035880=4.0463588851000154E8,
  1467035580=4.682640997200017E8, 1467035820=4.596651506800004E8}
```  
* 2016-06-30 23:11:06 准确率为0,BatchSize 从1 变为10

* 2016-06-30 23:45:26 没有改变worker 数目，BatchSize 从10 变为1，准确率为8.26%,查看日志发现准确率不高的原因是processCache 做的不好，中间夹杂着 TairClientException,结果日志如下：
[INFO 2016-07-01 00:06:45 c.a.m.r.j.b.f.ReportTbTmTradeThread:55 Thread-69] TmTbTradeSynchronization:  current plat form : platformTaobao_41084gxo4o_current plat trades per miniute{1467035760=4.653839051000002E8, 1467036240=3.1878713109000003E8, 1467035700=4.6232464525000066E8, 1467036180=3.485383597899996E8, 1467035640=4.5767568932999945E8, 1467036120=4.4614810382000077E8, 1467035580=4.682640997199994E8, 1467036060=4.6036800589000005E8,
1467035520=4.533635996399979E8, 1467036000=4.547603087799997E8, 1467035460=4.599145386199971E8, 1467035940=4.60859667780003E8, 1467035400=3.2907010480000013E8, 1467035880=4.529747201400005E8, 1467035820=4.5966515067999804E8, 1467036300=4.222259005000001E7}
[INFO 2016-07-01 00:06:47 c.a.m.r.j.b.f.ReportTbTmTradeThread:55 Thread-67] TmTbTradeSynchronization:  current plat form : platformTmall_41084gxo4o_current plat trades per miniute{1467035760=4.056556434999991E7, 1467036240=2.656929417999998E7, 1467035700=4.0238176350000024E7, 1467036180=3.0314971129999954E7, 1467035640=3.981135578000001E7, 1467036120=3.7114430539999954E7, 1467035580=4.1786499279999964E7, 1467036060=3.874381703E7, 1467035520=4.089747274000004E7,
1467036000=4.397011325E7, 1467035460=3.837811782000003E7, 1467035940=4.110613187000003E7, 1467035400=3.0215173469999965E7, 1467035880=4.1725599399999954E7, 1467035820=3.757089559999997E7, 1467036300=4391484.069999998}
[INFO 2016-07-01 00:07:07 c.a.m.r.j.b.f.ReportPcMbRatioThread:41 Thread-68] WirelessPcTotalTradesBeforeCalculateRatio: Wireless client total trades every miniutes is :  {1467035760=3.6553409585099936E9, 1467036240=7.284501185249997E9, 1467035700=3.1592616654199934E9, 1467036180=6.942561340759996E9, 1467035640=2.666527166759993E9, 1467036120=6.571264977019998E9, 1467035580=2.178881315129994E9, 1467036060=6.095201161269997E9, 1467035520=1.6786801368599954E9,
1467036000=5.605782580839995E9, 1467035460=1.194192153119997E9, 1467035940=5.116626875109996E9, 1467035400=7.048870740999994E8, 1467035880=4.625056686509994E9, 1467035820=4.142257425219992E9, 1467036300=7.337486972029997E9}pc client total trades every miniutes is :  {1467035760=7.183326200999999E7, 1467036240=1.4794344274999997E8, 1467035700=6.196308564999998E7, 1467036180=1.4155572696999997E8, 1467035640=5.213476270999998E7, 1467036120=1.3345531830999999E8,
1467035580=4.229356922999998E7, 1467036060=1.2371746966999999E8, 1467035520=3.244414849999999E7, 1467036000=1.1402422717999998E8, 1467035460=2.2671059859999992E7, 1467035940=1.0444951087999998E8, 1467035400=1.3683482439999992E7, 1467035880=9.405389982999998E7, 1467035820=8.215284157999998E7, 1467036300=1.4886959674999997E8}

* 2016/07/01 00:22:18 BatchSiz 从1 变为10 正确率为0，日志如下，原因还是本地缓存没有做好
[ERROR 2016-07-01 00:26:02 c.a.m.r.j.b.PayMessageDeserializeBolt:176 Thread-36] DeserializeLog: get info from  local Cache fail , execute collector's fail function, orderId is : query local cache Succeed Count: 2837query local Cache FailCount:  32821
[ERROR 2016-07-01 00:38:53 c.a.m.r.j.b.PayMessageDeserializeBolt:176 Thread-48] DeserializeLog: get info from  local Cache fail , execute collector's fail function, orderId is : query local cache Succeed Count: 0query local Cache FailCount:  60957

* 2016/07/01 00:48:19 BatchSize 从 10 变回1 ，正确率为11.29% 等待查看日志

分析上面原因发现就是因为cache没有做好

